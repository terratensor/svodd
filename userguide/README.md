<!--  
Оригинал на английском

-->

# Полнотекстовые операторы

Строка запроса может содержать операторы, определяющие условия поиска.

## Логические операторы

### Оператор AND — «и»

Логический оператор AND всегда неявно присутствует, поэтому запрос "яблоки бананы" подразумевает, что должны быть найдены как «яблоки», так и «бананы». Явного оператора AND в системе не существует.

```
яблоки бананы
```

### Оператор OR — «или»

Логический оператор OR `|` имеет более высокий приоритет, чем AND, поэтому `фрукты яблоки | бананы | груши` означает `фрукты (яблоки | бананы | груши)`, а не `(фрукты яблоки) | бананы | груши`. Оператор «или» задаётся в системе только прямой чертой `|`, в форме `OR` он не существует.

```
яблоки | бананы
```

### Оператор MAYBE — «возможно»

```
яблоко MAYBE банан
```

Оператор `MAYBE` работает аналогично оператору `|`, но он не возвращает документы, содержащие только слово после оператора, то есть сначала будут найдены все документы с «яблоком» в которых упомянут «банан», и затем остальные документы с «яблоком», но документов с одним только «яблоком» в выдаче не будет.

### Оператор отрицания 

```
яблоки -бананы
яблоки !бананы
```

Оператор отрицания указывает, что в результатах должно отсутствовать отмеченное им слово. В таком случае будут найдены все документы с «яблоками», не содержащие «банан». Запросы, содержащие **_только_** отрицания, по умолчанию **_не_** поддерживаются. 
<!--
### Оператор поиска по полю

```
@title яблоко @body банан
```


Оператор ограничения поля ограничивает последующие поиски указанным полем. По умолчанию запрос завершается сообщением об ошибке, если заданное поле не существует в искомой таблице. Однако это поведение можно предотвратить, указав параметр "@@relaxed" в начале запроса:

```
@@relaxed яблоко банан
```

Это может быть полезно при поиске в разнородных таблицах с различными схемами.


Ограничения на расположение полей дополнительно ограничивают поиск до первых N позиций в пределах данного поля или полей. Например, "@body [50] яблоко" не будет соответствовать документам, в которых ключевое слово «яблоко» появляется в позиции 51 или позже в тексте.

```
@body[50] яблоко
```

Оператор многопольного поиска позволяет искать слова по всем указанным полям, например в тексте и в заголовке одновременно.

```
@(title,body) яблоко банан
```

Оператор, игнорирующий поиск по полю игнорирует любые совпадения с запросом «яблоко банан» в поле «название» `title`:

```
@!title яблоко банан
```

Оператор, игнорирующий поиск по нескольким полям 
(если есть поля 'title', 'subject' и 'body', то `@!(title)` эквивалентно `@(title,body)`): 

```
@!(title,body) яблоко банан
```

Оператор поиска по всему полю:

```
@* яблоко
```
-->

<!-- ### Оператор поиска по фразе

```
"яблоко банан"
```

Оператор фразы требует, чтобы слова располагались рядом друг с другом.

Оператор поиска по фразе может включать модификатор "соответствия любому термину". В операторе фраза термины являются позиционно значимыми. При использовании модификатора "соответствовать любому термину" позиции последующих терминов в запросе по фразе будут смещены. В результате модификатор "соответствует любому" не влияет на производительность поиска. 

```
"точная * фраза * * для терминов"
```
-->

### Оператор близости слов

```
"яблоко банан"~10
```

Расстояние близости измеряется в количестве слов и применяется ко всем словам, заключенным в кавычки. Например, запрос `"яблоко, банан, груша"~5` из трёх слов и пятёрки в модификаторе указывает, что в нем должно быть менее 5+3 — восьми слов, содержащих все эти три. Следовательно, документ с текстом `яблоко ааааа ббббб ввввв банан ггггг ддддд груша` не будет соответствовать этому запросу, так как его длина составляет ровно восемь слов.

### Оператор сопоставления кворума

```
"яблоко банан груша апельсин вишня арбуз"/3
```

Оператор сопоставления кворума вводит тип нечеткого сопоставления. Он будет сопоставлять только те документы, которые соответствуют заданному пороговому значению заданных слов. В приведенном выше примере `"яблоко банан груша апельсин вишня арбуз"/3` он будет соответствовать всем документам, содержащим как минимум 3 из 6 указанных слов. Оператор ограничен 255 ключевыми словами. Вместо абсолютного числа вы также можете указать значение от 0,0 до 1,0 (что соответствует 0% и 100%), и система будет сопоставлять только документы, содержащие по крайней мере указанный процент заданных слов. Тот же пример, что был приведен выше, можно также выразить как `"яблоко банан груша апельсин вишня арбуз"/0.5`, и он будет соответствовать документам, содержащим не менее половины от указанных слов.

### Оператор строгого порядка

```
яблоко << банан << груша
```

Оператор строгого порядка (также известный как оператор BEFORE) соответствует документу только в том случае, если его ключевые слова-аргументы отображаются в документе точно в том порядке, который указан в запросе. Например, запрос "яблоко << банан" будет соответствовать документу "яблоко, рядом банан", но не документу "банан, а также яблоко". Оператор порядка имеет самый низкий приоритет. Его можно применять как к отдельным ключевым словам, так и к более сложным выражениям. Например, это корректный запрос:

```
(яблоки бананы груши апельсины) << "яблоко и банан с грушей" << яблоко|банан|груша
```

### Модификатор точной формы

```
яблоко =бананов и =груш
```

Модификатор ключевого слова "точная форма" соответствует документу только в том случае, если ключевое слово отображается в точной указанной форме, учитывается падеж, склонение, род, число и тп. По умолчанию это не так, например, запрос "бегун" будет соответствовать как документу, содержащему "бегал", так и документу, содержащему "бегущий", поскольку обе формы содержат просто "бег". Однако запрос "=бегун" будет соответствовать только первому документу. 

<!-- ????? Другой вариант использования - предотвратить использование [expanding](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#expand_keywords) ключевого слова в форме "*ключевое слово*". Например, с помощью `index_exact_words=1` + `expand_keywords=1/star`, `bcd` найдет документ, содержащий `abcde`, но `=bcd` - нет. -->

```
="одно яблоко и несколько бананов и груш"
```
Как модификатор, влияющий на ключевое слово, он может использоваться в таких операторах, как операторы фразы, близости и кворума. Возможно применение модификатора точной формы к оператору фразы, и в этом случае он внутренне добавляет модификатор точной формы ко всем терминам во фразе.

### Оператор с подстановочным символом

```
яблок* *блок* *блоки
```

В ходе поиска будет предпринята попытка найти все расширения для термина с подстановочным символом, и каждое расширение будет записываться как совпадающее попадание. Поиск с подстановочным символом может существенно повлиять на время ожидания ответа.

Поддерживаются следующие встроенные операторы подстановки:

* `?` может соответствовать любому отдельному символу: "?блок" будет соответствовать "яблок", но не "тыблок"
* `%` может соответствовать нулю или одному символу: "яблок%" будет соответствовать `яблок` или `яблоки`, но не `яблокам`


### Оператор REGEX — «регулярные выражения»

```
REGEX(/t.?e/)
```

Аналогично оператору с подстановочным символом, оператор регулярного выражения пытается найти все термины, соответствующие предоставленному шаблону. Это может существенно повлиять на время поиска по запросу, поскольку шаблон сопоставляется со всеми записями.

Шаблоны должны соответствовать синтаксису [RE2](https://github.com/google/re2/wiki/Syntax). Разделитель регулярных выражений — это первый символ после открытой скобки. Другими словами, весь текст между открытой скобкой, за которой есть разделитель, и закрытой скобкой, перед которой также есть разделитель, является регулярным выражением.

<!-- ???? Термины, хранящиеся в словаре, подвергаются преобразованию "charset_table". Это означает, что оператор REGEX может не  сопоставить символы верхнего регистра, если все символы написаны в нижнем регистре в соответствии с `charset_table` (что происходит по умолчанию). Чтобы успешно сопоставить термин с помощью регулярного выражения, шаблон должен соответствовать всему токену. Для достижения частичного соответствия поместите `.*` в начале и/или в конце вашего шаблона. -->

```
REGEX(/.{3}t/)
REGEX(/t.*\d*/)
```
<!--
### Модификаторы начала поля и конца поля

```
^яблоки бананы$
```

Модификаторы ключевых слов начала поля и конца поля гарантируют соответствие ключевому слову только в том случае, если оно находится в самом начале или в самом конце полнотекстового поля соответственно. Например, запрос `"^яблоки бананы$"` (кавычки нужны чтобы объединить с модификаторами начала и конца поля всю фразу целиком) будет соответствовать исключительно документам, содержащим по крайней мере одно поле с этими двумя конкретными ключевыми словами.
-->

### Модификатор рейтинга

```
яблоко^1.234 
```

Модификатор рейтинга повышает [рейтинг слова](https://ru.wikipedia.org/wiki/TF-IDF) на указанный коэффициент. Это никак не влияет на процесс поиска слов, но изменяет позицию в выдаче, в которой учитывается рейтинг. Модификатор задаётся треугольной скобкой-домиком `^` вплотную к искомому слову, следом вплотную указывается коэффициент, на который нужно будет повысить рейтинг. Это полезно в случаях, когда запрос состоит из нескольких терминов, которые будут обрабатываться системой равнозначно, а наверху выдачи требуется получить результаты с большим весом определённого слова. 

### Оператор NEAR — «рядом»

```
яблоки NEAR/3 бананы NEAR/4 "мой тест"
```

Оператор NEAR это более обобщенная версия оператора близости слов. Его синтаксис "NEAR/N" чувствителен к регистру и не допускает пробелов между ключом "NEAR", знаком косой черты / и значением расстояния N.

В то время как исходный оператор близости слов работает только с наборами ключевых слов, NEAR более универсален и может принимать произвольные подвыражения в качестве двух своих аргументов. Он соответствует документу, когда оба подвыражения находятся в пределах N слов друг от друга, независимо от их порядка. `NEAR` является левоассоциативным и имеет тот же самый низкий приоритет, что и [BEFORE](https://github.com/terratensor/svodd/tree/main/userguide/README.md#оператор-строгого-порядка).

Важно отметить, что выражение "яблок РЯДОМ/7, бананов РЯДОМ /7, груш" не эквивалентно выражению "яблок, бананов, груш"~7". Ключевое отличие заключается в том, что оператор близости слов допускает не более шести несовпадающих слов между всеми тремя совпадающими словами, в то время как версия NEAR меьше ограничивает, допуская до шести слов между «яблоками» и «бананами», а затем еще до шести слов между ними и «грушами».

### Оператор NOTNEAR

```
яблоки NOTNEAR/3 бананы
```
Оператор `NOTNEAR` служит в качестве отрицательного утверждения. Он соответствует документу, когда присутствует левый аргумент, а правый аргумент либо отсутствует в документе, либо находится на расстоянии от левого не меньше указанного количества слов. Синтаксис `NOTNEAR/N` чувствителен к регистру и не допускает пробелов между ключевым словом NOTNEAR, знаком косой черты / и значением расстояния N. Оба аргумента этого оператора могут быть словами, любыми другими операторами или группами операторов.

<!--
### Операторы SENTENCE «предложение» и PARAGRAPH «параграф»

```
all SENTENCE words SENTENCE "in one sentence"
```

```
"Билл Гейтс", PARAGRAPH "Стив Джобс"
```
Операторы предложения и параграфа находят результаты, если оба их аргумента находятся в пределах одного предложения или одного абзаца текста соответственно. Этими аргументами могут быть ключевые слова, фразы или экземпляры одного и того же оператора. Порядок следования аргументов в предложении или абзаце не имеет значения. 


### Оператор ZONE «ограничение зоны»

```
ZONE:(h3,h4)

только в заголовках этого уровня
```

Оператор ограничения зоны очень похож на оператор ограничения поля, но ограничивает соответствие указанной зоне в поле или списку зон. Важно отметить, что последующие подвыражения не обязательно должны совпадать в пределах одного непрерывного интервала данной зоны, они могут совпадать в нескольких интервалах. Например, запрос `(ZONE:th hello world)` будет соответствовать следующему образцу документа:

```html
<th>Table 1. Local awareness of Hello Kitty brand.</th>
.. some table data goes here ..
<th>Table 2. World-wide brand awareness.</th>
```

Оператор ограничения зоны влияет на запрос до тех пор, пока не будет введен новый оператор ограничения поля или зоны, или пока не будет введена закрывающая скобка. Он работает исключительно с таблицами, созданными с поддержкой зон (см. [index_zones](../../Creating_a_table/NLP_and_tokenization/Advanced_HTML_tokenization.md#index_zones)) и в противном случае будет игнорироваться.

### Оператор ZONESPAN «ограничение диапазона» 

```
ZONESPAN:(h2)

только в заголовке второго уровня
```

Оператор ограничения диапазона похож на оператор ZONE, но требует, чтобы совпадение происходило в пределах одного непрерывного диапазона. В приведенном выше примере "ZONESPAN:th hello world" не соответствовал бы документу, поскольку "hello" и "world" расположены в разных диапазонах.
-->
------

### Режим нечёткого поиска

Этот режим не относится к текстовым модификаторам, а включается и отключается галочкой в настройках поиска. По умолчанию режим включён. В результате его работы слова, набранные с ошибками, опечатками, или имеющими разную, но близкую форму, тоже ищутся и попадают в выдачу. Это удобно, когда в комментарии или запросе был набран текст с ошибкой, тогда в выдаче появятся все варианты — и верный, и ошибочный. 

В редких, но метких случаях бывает, что какое-то слово имеет много вариантов написания. Например, в книгах по военно-морской тематике можно встретить адмирала Элмо Зумволта, также его фамилией назван класс кораблей — в русском языке фамилия имеет четыре официальных транскрипции, а при составлении вариантов их будет ещё больше — `у` может быть `а`, `в` может быть `у`, `о` может быть `а`, `т` может быть `д`, и также после `л` может быть, а может не быть мягкого знака. Таким образом, Замвольт и Зумвалд, как и другие варианты, имеют ненулевую вероятность появления.

Например, в военно-исторической библиотеке:
- Замуолт 11 записей
- Замволт 10 записей 
- Зумволт 5 записей
- Зумвольт 2 записи
- Замвольт 1 запись
- Зумвальт 1 запись

Теперь один поисковый запрос в любой форме отдаёт все или почти такие записи вместе. Это пример очень сложного случая и данной технологией покрывается не на 100%, однако результаты значительно лучше, чем в обычном режиме — вместо перебора десятков вариантов. В более распространённых случаях ошибок и опечаток нечёткий поиск позволит найти практически все случаи совпадений. 

