# Полнотекстовые операторы

Строка запроса может содержать конкретные операторы, которые определяют условия для сопоставления слов из строки запроса.

### Логические операторы

#### Оператор AND — «и»

Логический оператор AND неявно всегда присутствует, поэтому "hello world" подразумевает, что в соответствующем документе должны быть найдены как "hello", так и "world". Явного оператора AND в системе не существует.

```
hello world
```

#### Оператор OR — «или»

Логический оператор OR `|` имеет более высокий приоритет, чем AND, поэтому "поиск кошки | собаки | мыши" означает "поиск (кошки | собаки | мыши)", а не "(поиск кошки) | собаки | мыши". Оператор OR задаётся в системе только прямой чертой |, в форме OR он не существует.

```
hello | world
```

### Оператор MAYBE — «возможно»

```
hello MAYBE world
```

------ Оператор `MAYBE` работает аналогично оператору `|`, но он не возвращает документы, которые соответствуют ??? только правильному выражению поддерева.

### Оператор отрицания

```
hello -world
привет !мир
```

Оператор отрицания указывает, что в результатах должно отсутствовать отмеченное им слово. Запросы, содержащие **только** отрицания, по умолчанию **не** поддерживаются. 

### Оператор поиска по полю

```
@title привет @мир тела
```

Оператор ограничения поля ограничивает последующие поиски указанным полем. По умолчанию запрос завершается ошибкой с сообщением об ошибке, если заданное имя поля не существует в искомой таблице. Однако это поведение можно предотвратить, указав параметр "@@relaxed" в начале запроса:

```
@@relaxed @nosuchfield мой запрос
```

Это может быть полезно при поиске в разнородных таблицах с различными схемами.

Ограничения на расположение полей дополнительно ограничивают поиск до первых N позиций в пределах данного поля (или полей). Например, "@body [50] hello" не будет соответствовать документам, в которых ключевое слово "hello" появляется в позиции 51 или позже в тексте.

```
@body[50] hello
```

Оператор многопольного поиска:

```
@(название, основная часть) привет, мир
```

Игнорировать оператор поиска по полю (игнорирует любые совпадения с "hello world" из поля "название"):

```
@!название hello world
```

Игнорируйте оператор поиска по нескольким полям (если есть поля 'title', 'subject' и 'body', то `@!(заголовок)` эквивалентно `@(тема, тело)`):

```
@!(заголовок, тело) hello world
```

Оператор поиска по всему полю:

```
@* здравствуйте
```

### Оператор поиска по фразе

```
"привет, мир"
```

Оператор фразы требует, чтобы слова располагались рядом друг с другом.

Оператор поиска по фразе может включать модификатор "соответствовать любому термину". В операторе "фраза" термины являются позиционно значимыми. При использовании модификатора "соответствовать любому термину" позиции последующих терминов в запросе по фразе будут смещены. В результате модификатор "соответствует любому" не влияет на производительность поиска.

```
"точная * фраза * * для терминов"
```

### Оператор близкого поиска

```
"привет, мир"~10
```

Расстояние близости измеряется в словах с учетом количества слов и применяется ко всем словам, заключенным в кавычки. Например, запрос `"кошка, собака, мышь"~5` указывает, что в нем должно быть не более 8 слов, содержащих все 3 слова. Следовательно, документ с `КОШКА aaa bbb ccc СОБАКА eee fff МЫШЬ` не будет соответствовать этому запросу, так как его длина составляет ровно 8 слов.

### Оператор сопоставления кворума

```
"мир - прекрасное место"/3
```

Оператор сопоставления кворума вводит тип нечеткого сопоставления. Он будет сопоставлять только те документы, которые соответствуют заданному пороговому значению заданных слов. В приведенном выше примере `"the world is a wonderful place"/3` он будет соответствовать всем документам, содержащим как минимум 3 из 6 указанных слов. Оператор ограничен 255 ключевыми словами. Вместо абсолютного числа вы также можете указать значение от 0,0 до 1,0 (что соответствует 0% и 100%), и система будет сопоставлять только документы, содержащие по крайней мере указанный процент заданных слов. Тот же пример, что был приведен выше, можно также выразить как `"the world is a wonderful place"/0.5`, и он будет соответствовать документам, содержащим не менее 50% из 6 слов.

### Оператор строгого порядка

```
aaa << ввв << ссс
```

Оператор строгого порядка (также известный как оператор "before") соответствует документу только в том случае, если его ключевые слова-аргументы отображаются в документе точно в том порядке, который указан в запросе. Например, запрос "черный << кот" будет соответствовать документу "черно-белый кот", но не документу "этот кот был черным". Оператор порядка имеет самый низкий приоритет. Его можно применять как к отдельным ключевым словам, так и к более сложным выражениям. Например, это корректный запрос:

```
(набор слов) << "точная фраза" << красный|зеленый|синий
```

### Точный модификатор формы

```
raining =кошки и =собаки
="точная фраза"
```

Модификатор ключевого слова "точная форма" соответствует документу только в том случае, если ключевое слово отображается в точной указанной форме, учитывается падеж, склонение, род, число и тп. По умолчанию это не так, например, запрос "бегун" будет соответствовать как документу, содержащему "бегал", так и документу, содержащему "бегущий", поскольку обе формы содержат просто "бег". Однако запрос "=бегун" будет соответствовать только первому документу. 

---- ????? Другой вариант использования - предотвратить использование [expanding](../../Creating_a_table/NLP_and_tokenization/Wildcard_searching_settings.md#expand_keywords) ключевого слова в форме "*ключевое слово*". Например, с помощью `index_exact_words=1` + `expand_keywords=1/star`, `bcd` найдет документ, содержащий `abcde`, но `=bcd` - нет.

Как модификатор, влияющий на ключевое слово, он может использоваться в таких операторах, как операторы фразы, близости и кворума. Возможно применение модификатора точной формы к оператору фразы, и в этом случае он внутренне добавляет модификатор точной формы ко всем терминам во фразе.

### Оператор с подстановочным символом

```
nation* *nation* *national
```

В ходе поиска будет предпринята попытка найти все расширения для термина с подстановочным символом, и каждое расширение будет записываться как совпадающее попадание. Поиск с подстановочным символом может существенно повлиять на время ожидания ответа.

Поддерживаются следующие встроенные операторы подстановки:

* `?` может соответствовать любому отдельному символу: "t?st" будет соответствовать "test", но не "teast"
* `%` может соответствовать нулю или одному символу: "tes%" будет соответствовать `tes` или `test`, но не `testing`


### Оператор REGEX «регулярные выражения»

```
REGEX(/t.?e/)
```

Аналогично оператору с подстановочным символом, оператор регулярного выражения пытается найти все термины, соответствующие предоставленному шаблону. Это может существенно повлиять на время поиска по запросу, поскольку шаблон сопоставляется со всеми записями.

Шаблоны должны соответствовать синтаксису [RE2](https://github.com/google/re2/wiki/Syntax). Разделитель регулярных выражений — это первый символ после открытой скобки. Другими словами, весь текст между открытой скобкой, за которой есть разделитель, и закрытой скобкой, перед которой также есть разделитель, является регулярным выражением.

--- ???? Термины, хранящиеся в словаре, подвергаются преобразованию "charset_table". Это означает, что оператор REGEX может не  сопоставить символы верхнего регистра, если все символы написаны в нижнем регистре в соответствии с `charset_table` (что происходит по умолчанию). Чтобы успешно сопоставить термин с помощью регулярного выражения, шаблон должен соответствовать всему токену. Для достижения частичного соответствия поместите `.*` в начале и/или в конце вашего шаблона.

```
REGEX(/.{3}t/)
REGEX(/t.*\d*/)
```

### Модификаторы начала поля и конца поля

```
^привет, мир$
```

Модификаторы ключевых слов начала поля и конца поля гарантируют соответствие ключевому слову только в том случае, если оно находится в самом начале или в самом конце полнотекстового поля соответственно. Например, запрос `"^hello world$"` (кавычки нужны чтобы объединить с модификаторами начала и конца поля всю фразу целиком) будет соответствовать исключительно документам, содержащим по крайней мере одно поле с этими двумя конкретными ключевыми словами.

### Модификатор IDF boost

```
boosted^1.234 boostedfieldend$^1.234
```

Модификатор boost повышает рейтинг слова [IDF_score](../../Searching/Options.md#idf) на указанный коэффициент. Это никак не влияет на процесс сопоставления терминов, но изменяет позицию в выдаче в режимах показа, в которых учитывается рейтинг.

### Оператор NEAR «рядом»

```
hello NEAR/3 мир NEAR/4 "мой тест"
```

Оператор "РЯДОМ" - это более обобщенная версия оператора приближения. Его синтаксис - "NEAR/N", который чувствителен к регистру и не допускает пробелов между ключевыми словами "NEAR", знаком косой черты и значением расстояния.


В то время как исходный оператор приближения работает только с наборами ключевых слов, "NEAR" более универсален и может принимать произвольные подвыражения в качестве двух своих аргументов. Он соответствует документу, когда оба подвыражения находятся в пределах N слов друг от друга, независимо от их порядка. `NEAR` является левоассоциативным и имеет тот же (самый низкий) приоритет, что и [BEFORE](../../Searching/Full_text_matching/Operators.md#Оператор строгого порядка).

Важно отметить, что "один РЯДОМ/7, два РЯДОМ /7, три" не совсем эквивалентно "один, два, три"~7". Ключевое отличие заключается в том, что оператор приближения допускает до 6 несовпадающих слов между всеми тремя совпадающими словами, в то время как версия с "NEAR" менее ограничительна: она допускает до 6 слов между "one" и "two", а затем еще до 6 между этими двумя совпадающими словами и `три`.

### Оператор NOTNEAR

```
Церковь НЕПОДАЛЕКУ/улица 3
```
Оператор `NOTNEAR` служит в качестве отрицательного утверждения. Он соответствует документу, когда присутствует левый аргумент, а правый аргумент либо отсутствует в документе, либо правый аргумент находится на указанном расстоянии от конца левого соответствующего аргумента. Расстояние обозначается словами. Синтаксис `NOTNEAR/N` чувствителен к регистру и не допускает пробелов между ключевым словом `NOTNEAR`, знаком косой черты и значением расстояния. Оба аргумента этого оператора могут быть терминами, любыми операторами или группой операторов.

### Операторы SENTENCE «предложение» и PARAGRAPH «параграф»

```
all SENTENCE words SENTENCE "in one sentence"
```

```
"Билл Гейтс", PARAGRAPH "Стив Джобс"
```
Операторы предложения и параграфа находят результаты, если оба их аргумента находятся в пределах одного предложения или одного абзаца текста соответственно. Этими аргументами могут быть ключевые слова, фразы или экземпляры одного и того же оператора. Порядок следования аргументов в предложении или абзаце не имеет значения. 


### Оператор ZONE «ограничение зоны»

```
ZONE:(h3,h4)

только в заголовках этого уровня
```

Оператор ограничения зоны очень похож на оператор ограничения поля, но ограничивает соответствие указанной зоне в поле или списку зон. Важно отметить, что последующие подвыражения не обязательно должны совпадать в пределах одного непрерывного интервала данной зоны, они могут совпадать в нескольких интервалах. Например, запрос `(ZONE:th hello world)` будет соответствовать следующему образцу документа:

```html
<th>Table 1. Local awareness of Hello Kitty brand.</th>
.. some table data goes here ..
<th>Table 2. World-wide brand awareness.</th>
```

Оператор ограничения зоны влияет на запрос до тех пор, пока не будет введен новый оператор ограничения поля или зоны, или пока не будет введена закрывающая скобка. Он работает исключительно с таблицами, созданными с поддержкой зон (см. [index_zones](../../Creating_a_table/NLP_and_tokenization/Advanced_HTML_tokenization.md#index_zones)) и в противном случае будет игнорироваться.

### Оператор ZONESPAN «ограничение диапазона» 

```
ZONESPAN:(h2)

только в заголовке второго уровня
```

Оператор ограничения диапазона похож на оператор ZONE, но требует, чтобы совпадение происходило в пределах одного непрерывного диапазона. В приведенном выше примере "ZONESPAN:th hello world" не соответствовал бы документу, поскольку "hello" и "world" расположены в разных диапазонах.
